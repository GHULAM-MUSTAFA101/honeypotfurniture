{% comment %}
✅ Fabric & Colour Section
- One level of blocks only (no nested blocks)
- Each block can be:
  - type: fabric → main image
  - type: swatch → linked to fabric via fabric_id
{% endcomment %}

<section class="fabric-section_main">
  <div class="fabric-section">

    <!-- Header -->
    <div class="fabric-header">
      <h2 class="fabric-step">{{ section.settings.heading_number }}</h2>
      <h3 class="fabric-title">{{ section.settings.heading }}</h3>
      <p class="fabric-desc">{{ section.settings.subheading_1 }}</p>
      <p class="fabric-desc">{{ section.settings.subheading_2 }}</p>
    </div>

    <!-- Fabric Grid -->
    <div class="fabric-grid">
      {% assign fabrics = section.blocks | where: "type", "fabric" %}
      {% for fabric in fabrics %}
        <div class="fabric-item" data-fabric-item data-fabric-id="{{ fabric.id }}">
          <div class="fabric-image">
            {% if fabric.settings.main_image != blank %}
              <img src="{{ fabric.settings.main_image | image_url: width: 500 }}" alt="{{ fabric.settings.title }}" data-fabric-main-image>
            {% else %}
              <div class="placeholder-image">No image</div>
            {% endif %}
          </div>
          <p class="fabric-name">{{ fabric.settings.title }}</p>

          <!-- Swatches -->
          <div class="fabric-swatches">
            {% assign swatches = section.blocks | where: "type", "swatch" | where: "settings.fabric_id", fabric.id %}
            {% for swatch in swatches %}
              <span
                class="fabric-swatch {% if swatch.settings.swatch_image != blank %}has-image{% endif %}"
                style="{% if swatch.settings.swatch_color != blank %}background-color: {{ swatch.settings.swatch_color }};{% endif %}"
                data-swatch-image="{% if swatch.settings.swatch_image != blank %}{{ swatch.settings.swatch_image | image_url: width: 500 }}{% endif %}">
                
                {% if swatch.settings.swatch_image != blank %}
                  <img src="{{ swatch.settings.swatch_image | image_url: width: 40 }}" alt="Swatch" class="swatch-thumb">
                {% endif %}
              </span>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>

  </div>
</section>

{% schema %}
{
  "name": "Pick Your Fabric & Colour",
  "settings": [
    { "type": "text", "id": "heading_number", "label": "Step Number", "default": "STEP 5" },
    { "type": "text", "id": "heading", "label": "Main Heading", "default": "Pick Your Fabric & Colour" },
    { "type": "text", "id": "subheading_1", "label": "Line 1", "default": "Explore fabrics." },
    { "type": "text", "id": "subheading_2", "label": "Line 2", "default": "Choose your perfect color." }
  ],
  "blocks": [
    {
      "type": "fabric",
      "name": "Fabric",
      "settings": [
        { "type": "text", "id": "title", "label": "Fabric Name" },
        { "type": "image_picker", "id": "main_image", "label": "Fabric Image" }
      ]
    },
    {
      "type": "swatch",
      "name": "Swatch",
      "settings": [
        { "type": "text", "id": "fabric_id", "label": "Linked Fabric ID" },
        { "type": "color", "id": "swatch_color", "label": "Swatch Color" },
        { "type": "image_picker", "id": "swatch_image", "label": "Swatch Image" }
      ]
    }
  ],
  "presets": [
    { "name": "Pick Your Fabric & Colour" }
  ]
}
{% endschema %}
